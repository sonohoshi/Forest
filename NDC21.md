# NDC21

넥슨 개발자 컨퍼런스, 2021. 그 중에 내가 직접 들은 세션만 정리한다.

## 로컬라이징 노하우 공유 - 데브캣 김한수 프로그래머

1. 국가별 빌드를 만드는 경우, 국가별로 완전한 맞춤 빌드를 만들 수 있지만, 비용이 많이 들고 버전 관리가 어렵다. 각 국가별로 전담 팀이 필요하게 될 것이다.
2. 글로벌 원빌드를 하는 경우, 저렴한 비용/지원 언어를 늘리기 쉽다. 그러나, 국가별 맞춤 서비스가 어렵다.

이번 세션에서는 글로벌 원빌드에 초점을 맞추고 이에 대해 발표하고자 한다.  

목차는 다음과 같다.  

1. 클라이언트 대응
2. 파일 포맷 선정
3. 개발환경 구축
4. 국가별 대응

### 클라이언트 대응

개행 없는 언어 대응, 언어별 폰트 문제, 텍스트가 포함된 이미지 처리, 금칙어 적용 범위, 닉네임 관련 처리. 기본적으로 이정도를 고려해야한다.

1. 개행 없는 언어에 대해 처리가 필요하다.

우리가 생각하는 것보다 많은 언어에서 띄어쓰기/개행이 없다. 중국어나 일본어, 태국어가 그렇다.  

그런데, 유니티의 경우는 `반각공백` 에 대해서만 적절히 개행을 해준다. UI의 Text, Best fit 옵션을 생각하면 될 것이다. 개행이 없는 언어의 경우 자를 포인트를 찾지 못하고 전체 문장을 줄여버리는 이슈가 생기기도 한다.  

1-1. 런타임에 글자폭을 계산해서 개행하는 방법  

글자 폭을 픽셀 단위로 계산, 원하는 크기에서 벗어날 경우 줄인 후 재귀적으로 체크를 하기도 한다. 재귀적인 로직때문에 시간이 조금 걸려서, 짧은 텍스트에 이런 방법을 썼다.  

1-2. 형태소 분석을 통해 반각 공백을 미리 삽입하는 방법  

형태소 분석 라이브러리를 이용해 잘려도 되는 곳에 반각 공백을 삽입, 폰트를 수정해 반각 공백의 폭을 0으로 만들어 처리를 했다. 그러나 빌드 전후로 처리를 해야하는 부분이 꽤 있었고, 유저가 채팅을 하다가 띄어쓰기가 하고싶을 때에는 또 문제가 된다는 점 때문에 더 나은 방법을 찾아보게 될 것 같다.  

2. 언어별 폰트 문제가 여러가지 있다.

언어를 여러개 지원하면, 그만큼 폰트 관련 문제도 나라별로 생기기 나름이다. 다음의 예시들과 함께 알아보자.  

2-1. 같은 한자지만 나라별로 쓰는 법이 다르기도 하다.  

'넓을 광' 자는 한/중/일 표기가 모두 심하게 다르다. 문제는 유니코드상에서 포인트가 완전히 같기 때문에, 언어별로 폰트를 다르게 쓸 수 있도록 시스템 구축이 필요하다.  

2-2. 폰트를 최소 3개는 써야하는데 심지어 한문 폰트가 포함될 경우, 폰트의 크기가 개당 16MB 정도 된다.  

이런게 세가지가 있으면 50MB 정도라서 메모리에 다 올려두기엔 상당히 부담스럽다. 이 때문에 필요한 폰트를 쓸 때만 로딩할 수 있게 시스템 구축이 필요하다.  

2-3. 언어별로 폰트/텍스트 수가 달라진다  

러시아를 지원하게 되면 번역 후 텍스트량이 1.5배 정도 늘어나게 된다. 따라서 디자이너들이 언어별로 폰트 사이즈를 지정할 수 있어야하고, 이에 따른 시스템 또한 구축해야 한다.  

3. 텍스트가 포함된 이미지 처리

사실 제일 좋은 방법은 애초부터 이미지에 텍스트를 안넣으면 된다. 글로벌 원빌드의 경우, 지원 언어가 많아 `이미지 수 * 언어 수만큼 고통스럽다.`  

국가별로 이미지를 교체하는 방법도 있겠지만 추천하진 않음. 실수가 발생할 여지가 많고 개발 비용도 많이 올라간다. 따라서 이벤트 기간처럼 변경되기 쉬운 정보는 텍스트 영역으로 빼놓는게 좋다.  

3-1. 텍스트와 이미지가 표시되는 영역을 분리한다  

상점 이미지 같은 경우, 최대한 이미지와 라벨이 들어갈 곳을 분리 후 텍스트 위치를 테이블 등으로 저장한 뒤 동적으로 구성하는 것이 좋다.  

4. 금칙어 적용 범위

금칙어를 받으면 언어별로 적용해야 하는가? 모든 언어에 대해 동일하게 적용해야 하는가? 뭐 이런 고민들이 있다. 사례를 통해 말해보겠다.  

4-1. 모든 언어에 같은 금칙어를 적용하는 경우  

엉뚱하게도, 아랍어 금칙어에 걸려서 한글 채팅이 안되거나 하는 경우가 있다.  

4-2. 언어별로 금칙어를 분리하는 경우  

서로 다른 언어권 사용자가 채팅 할 때, 한쪽에만 금칙어가 걸린다. 형평성 문제가 생긴다는 것입니다.  

어쨌거나, 어떤 경우에도 너무나도 일반적인 금칙어는 지양하는 편이 좋다. 예시로, 'SS'는 나치 친위대를 뜻하는 독일 금칙어지만 Pa'ss' 같은 단어도 못쓰게 만든다.  

5. 닉네임 관련 처리

`N글자 이하, 특수문자 제외` 라는 조건이 대부분인데, 여기서 '특수문자' 는 어디서부터 어디까지를 의미 할지 고려하다보면 머리가 아플 수 있음. 이럴 때, 정규식을 사용해 특수문자를 제외함.  

천지인 입력 때문에 입력 중/입력 후 정규식 처리가 다른데, 이 부분은 영상을 참고하면 될 것 같음.

### 파일 포맷 선정

1. 파일 포맷 선정

작업자간 충돌을 최소화 하는데 중점을 뒀고, 결론적으로는 작업용 포맷은 `JSON` 을 추천함.  

1-1. Json.net 라이브러리를 이용, Formatting.Indented 옵션을 적용  

이렇게 하면 한줄에 데이터 하나씩 표시가 가능하도록 정렬할 수 있다. 이를 이용, Git에서 충돌을 많이 줄일 수 있게 된다. 우리가 흔히 알고있는 그 NewtonSoft의 라이브러리가 맞다.  

1-2. 영역별로 파일을 분리하자  

파일을 분리하고 텍스트 키 등을 기준으로 정렬해둘 수록 충돌의 확률은 줄어들고, diff를 할 때 훨씬 시간이 적게 소요된다.  

1-3. 그러나 최종 빌드용 포맷은 `TSV/CSV/BSON` 을 추천한다.  

json은 구분자가 많이 들어가서 용량 낭비가 있고, 같은 내용이 json은 8MB, TSV는 2MB 정도로 차이가 심했던 경우도 있다.

2. 인코딩 이슈

2-1. 인코딩은 UTF-16 LE 추천  

한중일 언어를 2바이트로 표현할 수 있다. 기본 인코딩으로 자주 쓰이는 UTF-8의 경우 3바이트로 표현되는데, 대체로 UTF-16을 많이 이용하기도 해서 통일하기가 쉽다.  

그러나, git을 포함한 텍스트 편집기의 기본 인코딩은 대부분 UTF-8을 이용하기 때문에 미리 인코딩 세팅을 맞출 필요가 있다.

2-2. 편집기는 VS code 추천  

파일 인코딩을 직접 감지해줘서 인코딩 문제가 많이 편해진다. 그러나 필자는 요즘 IDE는 다들 성능이 좋아서 굳이? 라는 생각이 든다.  

3. 부가정보 기록

번역팀에도 데이터를 전달하는 경우가 생기니까, 주석처럼 추가적인 정보를 적어두는게 좋다.  

3-1. 화자  

화자와 대상에 따라 어투가 바뀌기도 한다.  

3-2. 텍스트 순서  

텍스트나 키를 사전 순서로 정렬했을 때, 시나리오 같은 경우엔 오히려 대사가 꼬여서 큰 문제가 생긴다. 미리 SortOrder를 기록해두고 이 순서대로 정렬을 해주면 도움이 된다.  

3-3. UI 너비  

허용 가능한 UI 너비도 대략적으로 기록해주면 좋음.  

3-4. 타겟 버전  

해당 데이터가 이번 패치에 포함되는지 혹은 작업중인 텍스트인지 처리해주면 큰 도움이 됨.  

### 개발환경 구축

라이브 서비스를 진행하며 처리해야했던 것들...

1. 긴급 패치용 텍스트 분리

텍스트는 패치 직전까지 빈번하게 수정하게 된다. 그나마 이는 수정 비용이 적기 때문에 수정될 일도 많고, 이에 대비 해야한다.  

1-1. 긴급 패치를 할 수 있도록 미리 별도로 텍스트를 분리  

별도로 텍스트를 준비, 전체 텍스트는 어셋번들로 관리하고 - 버전관리나 암호화하지 않는 텍스트 패치를 하나 더 제공, 준비하는 것을 권장한다.  

2. 텍스트 포맷팅

글로벌 원빌드에서는 이를 적극 권장한다. 글로벌 서비스에서는 텍스트가 변경되면 번역을 다시 해야하는 경우가 생긴다.  

2-1. 단순 숫자 등의 데이터 변경 시, 텍스트를 **다시 번역 할 필요가 없어진다**.  

2-2. 미리 텍스트 포맷팅을 적용해두면 **언어에 따라 어순이 다른 경우도 대응이 용이하다.**  

2-3. **날짜 표기법**의 경우 나라마다 표기법이 다르다.

또한, 이렇게 포맷팅을 적용하고 나면 한글 관련 조사 처리가 고민된다. 이 때, `KoreanFormatter` 라는 라이브러리를 사용한다. 이러한걸 적용하면 훨씬 부드러운 한글 처리가 가능해진다. 번역을 맡길 때, 조사를 번역하지 않도록 하는 부분이 필요하다.

3. 엑셀 Export / Import

이를 준비해두면 요긴한데, 서로 다른 시스템을 오갈 때, 의사소통이 간편하다.  

`NPOI` 라고 하는 POI를 .Net으로 포팅한 라이브러리가 있는데 이를 엑셀에 이용했고, 기능 자체는 유용했으나 라이브러리의 문서와 기능이 조금 부실한 편이었다.

### 국가별 대응 (중국 / 일본)

1. 판호

중국에 게임을 출시하기 위해 처리해야 할 것이다.  

요약하면  

- 종교, 폭력, 공산주의 부정하는 내용 금지

구체적으로는  

- 해골 / 핏자국 금지. 현재는 액체류 표현이 다 안됨.
- 죽은 사람이 되살아나도 안됨. 부두술 등의 종교적인 내용과 연결될 수 있음. (좀비 등)

따라서, 중국 진출을 계획하고 있다면 리소스 제작 시 미리 고려하는 것이 좋다. 제작 비용도 낭비이고...

2. 앱 마켓 대응 / 보이스 채팅

중국은 플레이 스토어 이외에도 수많은 앱 마켓이 존재하는데, 따라서 앱 마켓 수만큼 라이브러리를 추가해야 한다. 이에 따른 대응 외주 업체도 있다고 한다.  

또한, 보이스 채팅 기능이 추가로 필요하다. 음성 메모 정도의 기능이 있으면 좋은데, 텍스트를 입력하기 어렵고 성조 때문에 음독을 들어야 아는 경우가 있기 때문이다.

3. 자금 결제법 관련

일본은 게임 관련 법률이 까다로워 준비해야 하는 부분이 많다.  

3-1. 동일 아이템으로 구성 시, 보너스는 50%까지 가능.  

- 보석 1 + 1 =  OK

3-2. 다른 아이템을 섞을 시, 보너스는 30%까지 가능.  

- 보석 1 + 1 + '희귀카드' = NG

3-3. 보너스는 UI상 반드시 구분해야 하며, 유료 주얼과 무료 주얼은 DB상 반드시 구분해야한다.

4. 컴플리트 가챠 금지 / 우량 오인

4-1. 80% 까지만 모아도 모든 보너스를 획득 할 수 있어야 한다.  

4-2. 조합의 개수가 32종 이상이어야 한다.  

4-3. 특정 카드에게만 다른 효과가 발생하면 안된다.  

4-4. 실제 기능과 설명이 다른 상품을 판매하면 안된다.  

즉, 카드 및 아이템 텍스트를 오역하여 판매하는 경우도 문제가 된다.